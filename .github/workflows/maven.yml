# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Java CI with Maven

on:
  push:
    branches: [ master ]
jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Maven build and deploy
        run: |
          mvn test
      
      - name: Run tests
        run: |
          echo "::set-output name=mix-compile--warnings-as-errors::$(mix compile --warnings-as-errors)\n"
          echo "::set-output name=mix-format--check-formatted::$(mix format --check-formatted)\n"
          echo "::set-output name=mix-ecto_create::$(mix ecto.create)\n"
          echo "::set-output name=mix-ecto_migrate::$(mix ecto.migrate)\n"
          echo "::set-output name=mix-test::$(mix test)\n"
        id: run_tests
        env:
          MIX_ENV: test
          PGHOST: localhost
          PGUSER: postgres
